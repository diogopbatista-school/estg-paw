<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>Painel de Administrador</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" />
    <style>
      body {
        background: linear-gradient(to right, #1e3c72, #2a5298);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .container {
        max-width: 1000px;
        background: #ffffff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }
      .panel {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .panel h2 {
        background: #007bff;
        color: white;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
      }
      .filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-bottom: 15px;
      }
      .filters input {
        flex: 1;
        min-width: 200px;
      }
      .table th,
      .table td {
        text-align: center;
      }
      .btn {
        font-weight: bold;
        border-radius: 8px;
      }
    </style>
    <script>
      function filterTable(className, filters) {
        const rows = document.querySelectorAll("." + className);
        rows.forEach((row) => {
          let visible = true;
          Object.keys(filters).forEach((index) => {
            const cellText = row.cells[index].textContent.toLowerCase();
            if (!cellText.includes(filters[index].toLowerCase())) {
              visible = false;
            }
          });
          row.style.display = visible ? "" : "none";
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        const restaurantFilters = ["filter-name", "filter-description", "filter-location", "filter-phone"];
        restaurantFilters.forEach((id, index) => {
          document.getElementById(id).addEventListener("input", function () {
            filterTable("restaurant-row", {
              0: document.getElementById("filter-name").value,
              1: document.getElementById("filter-description").value,
              2: document.getElementById("filter-location").value,
              3: document.getElementById("filter-phone").value,
            });
          });
        });

        const userFilters = ["filter-user-name", "filter-user-email", "filter-user-phone", "filter-user-nif", "filter-user-role"];
        userFilters.forEach((id, index) => {
          document.getElementById(id).addEventListener("input", function () {
            filterTable("user-row", {
              0: document.getElementById("filter-user-name").value,
              1: document.getElementById("filter-user-email").value,
              2: document.getElementById("filter-user-phone").value,
              3: document.getElementById("filter-user-nif").value,
              4: document.getElementById("filter-user-role").value,
            });
          });
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center text-white">Painel de Administrador</h1>

      <!-- Seção de Restaurantes -->
      <div class="panel">
        <h2>Restaurantes</h2>
        <div class="filters">
          <input
            type="text"
            id="filter-name"
            class="form-control"
            placeholder="Filtrar por Nome" />
          <input
            type="text"
            id="filter-description"
            class="form-control"
            placeholder="Filtrar por Descrição" />
          <input
            type="text"
            id="filter-location"
            class="form-control"
            placeholder="Filtrar por Localização" />
          <input
            type="text"
            id="filter-phone"
            class="form-control"
            placeholder="Filtrar por Telefone" />
        </div>
        <% if (restaurants.length > 0) { %>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Descrição</th>
              <th>Telefone</th>
              <th>Localização</th>
              <th>Validado</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <% restaurants.forEach(function (restaurant) { %>
            <tr class="restaurant-row">
              <td><%= restaurant.name %></td>
              <td><%= restaurant.description || "Sem descrição" %></td>
              <td><%= restaurant.phone || "Sem telefone" %></td>
              <td>
                Latitude: <%= restaurant.location.latitude || "N/A" %><br />
                Longitude: <%= restaurant.location.longitude || "N/A" %>
              </td>
              <td><%= restaurant.verified ? "Sim" : "Não" %></td>
              <td>
                <a
                  href="/admin/toggle-validation/<%= restaurant._id %>"
                  class="btn <%= restaurant.verified ? 'btn-danger' : 'btn-success' %> btn-sm">
                  <%= restaurant.verified ? "Desvalidar" : "Validar" %>
                </a>
                <a
                  href="/restaurants/manage/<%= restaurant._id %>/edit"
                  class="btn btn-warning btn-sm"
                  >Editar</a
                >
                <a
                  href="/admin/delete-restaurant/<%= restaurant._id %>"
                  class="btn btn-danger btn-sm"
                  onclick="return confirm('Tem certeza que deseja apagar este restaurante?')"
                  >Apagar</a
                >
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <% } else { %>
        <p class="text-center text-muted">Nenhum restaurante encontrado.</p>
        <% } %>
      </div>

      <!-- Seção de Usuários -->
      <div class="panel">
        <h2>Usuários</h2>
        <div class="filters">
          <input
            type="text"
            id="filter-user-name"
            class="form-control"
            placeholder="Filtrar por Nome" />
          <input
            type="text"
            id="filter-user-email"
            class="form-control"
            placeholder="Filtrar por Email" />
          <input
            type="text"
            id="filter-user-phone"
            class="form-control"
            placeholder="Filtrar por Telefone" />
          <input
            type="text"
            id="filter-user-nif"
            class="form-control"
            placeholder="Filtrar por NIF" />
          <input
            type="text"
            id="filter-user-role"
            class="form-control"
            placeholder="Filtrar por Função" />
        </div>
        <% if (users.length > 0) { %>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Telefone</th>
              <th>NIF</th>
              <th>Função</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(function (user) { %>
            <tr class="user-row">
              <td><%= user.name %></td>
              <td><%= user.email %></td>
              <td><%= user.phone || "Sem telefone" %></td>
              <td><%= user.nif || "Sem NIF" %></td>
              <td><%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %></td>
              <td>
                <a
                  href="/admin/edit-user/<%= user._id %>"
                  class="btn btn-warning btn-sm"
                  >Editar</a
                >
                <a
                  href="/admin/delete-user/<%= user._id %>"
                  class="btn btn-danger btn-sm"
                  onclick="return confirm('Tem certeza que deseja apagar este usuário?')"
                  >Apagar</a
                >
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <% } else { %>
        <p class="text-center text-muted">Nenhum usuário encontrado.</p>
        <% } %>
      </div>

      <div class="d-flex justify-content-center">
        <a href="/users/dashboard" class="btn btn-secondary btn-lg w-48">Voltar</a>
      </div>
    </div>
  </body>
</html>
